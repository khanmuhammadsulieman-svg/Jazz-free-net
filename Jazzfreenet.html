// Photo-Booth-Consent-App.jsx // Single-file React app (Next.js / Vercel compatible) with Tailwind classes. // Purpose: ethical, opt-in "photo booth" demo. Explicit consent required.

import React, { useRef, useState } from 'react';

export default function PhotoBoothConsentApp() { const videoRef = useRef(null); const canvasRef = useRef(null); const [streaming, setStreaming] = useState(false); const [consentChecked, setConsentChecked] = useState(false); const [captured, setCaptured] = useState([]); const [status, setStatus] = useState(''); const [adminMode, setAdminMode] = useState(false); const [password, setPassword] = useState('');

async function startCamera() { try { const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false }); videoRef.current.srcObject = stream; await videoRef.current.play(); setStreaming(true); } catch (err) { console.error('Camera error', err); setStatus('Could not access camera: ' + err.message); } }

function stopCamera() { const stream = videoRef.current?.srcObject; if (stream) { stream.getTracks().forEach(t => t.stop()); videoRef.current.srcObject = null; } setStreaming(false); }

function capturePhoto() { if (!streaming || !canvasRef.current || !videoRef.current) return; const w = videoRef.current.videoWidth; const h = videoRef.current.videoHeight; canvasRef.current.width = w; canvasRef.current.height = h; const ctx = canvasRef.current.getContext('2d'); ctx.drawImage(videoRef.current, 0, 0, w, h); const dataUrl = canvasRef.current.toDataURL('image/jpeg', 0.85); setCaptured(prev => [...prev, dataUrl].slice(-3)); // keep up to 3 }

async function uploadCaptured() { if (captured.length === 0) { setStatus('No photos to upload.'); return; } setStatus('Uploading...'); try { const res = await fetch('/api/upload', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ images: captured }), }); const data = await res.json(); if (res.ok) { setStatus('Uploaded successfully.'); setCaptured([]); stopCamera(); } else { setStatus('Upload failed: ' + (data?.error || res.statusText)); } } catch (err) { setStatus('Upload error: ' + err.message); } }

function resetAll() { setCaptured([]); stopCamera(); setStatus(''); }

// Admin view toggle (simple client-side password). For real apps, use proper auth. function tryEnterAdmin() { if (password === process.env.NEXT_PUBLIC_ADMIN_PASSWORD || password === 'demo-pass') { setAdminMode(true); } else { alert('Wrong password. For demo try: demo-pass'); } }

return ( <main className="min-h-screen bg-slate-50 flex items-start justify-center p-6"> <div className="w-full max-w-3xl bg-white rounded-2xl shadow p-6 grid gap-4"> <header className="flex items-center justify-between"> <h1 className="text-2xl font-semibold">Photo Booth — Consent Required</h1> <div className="text-sm text-slate-500">Demo: for friends with explicit consent</div> </header>

{!adminMode ? (
      <section className="grid gap-3">
        <p className="text-sm">This demo will ask for camera access. Only continue if you consent to share pictures with the site owner. No deception.</p>

        <label className="inline-flex items-center gap-2">
          <input type="checkbox" checked={consentChecked} onChange={e => setConsentChecked(e.target.checked)} />
          <span className="text-sm">I explicitly consent to capture and upload my photos.</span>
        </label>

        <div className="flex gap-2">
          <button className="px-4 py-2 rounded bg-indigo-600 text-white" onClick={() => { if (!consentChecked) return alert('You must give consent.'); startCamera(); }}>Start Camera</button>
          <button className="px-4 py-2 rounded bg-gray-200" onClick={stopCamera}>Stop Camera</button>
          <button className="px-4 py-2 rounded bg-emerald-600 text-white" onClick={() => { if (!consentChecked) return alert('You must give consent.'); capturePhoto(); }}>Capture Photo</button>
          <button className="px-4 py-2 rounded bg-blue-600 text-white" onClick={uploadCaptured}>Upload Photos</button>
          <button className="px-4 py-2 rounded bg-red-400 text-white" onClick={resetAll}>Reset</button>
        </div>

        <div className="grid md:grid-cols-2 gap-4">
          <div>
            <video ref={videoRef} className="w-full rounded bg-black" playsInline muted />
            <canvas ref={canvasRef} style={{ display: 'none' }} />
          </div>
          <div>
            <h3 className="font-medium">Captured (up to 3)</h3>
            <div className="flex gap-2 mt-2">
              {captured.length === 0 && <div className="text-sm text-slate-500">No photos yet.</div>}
              {captured.map((d, i) => (
                <img key={i} src={d} alt={`captured-${i}`} className="h-28 rounded object-cover" />
              ))}
            </div>
          </div>
        </div>

        <div className="text-sm text-slate-600">Status: {status}</div>

        <hr />

        <div>
          <h4 className="font-medium">Admin (demo)</h4>
          <div className="flex gap-2 mt-2">
            <input type="password" value={password} onChange={e => setPassword(e.target.value)} placeholder="admin password" className="border px-3 py-2 rounded w-64" />
            <button className="px-3 py-2 bg-slate-700 text-white rounded" onClick={tryEnterAdmin}>Enter</button>
          </div>
          <div className="text-xs text-slate-400 mt-2">Note: This is a demo; set NEXT_PUBLIC_ADMIN_PASSWORD in environment for real use.</div>
        </div>
      </section>
    ) : (
      <section>
        <h2 className="text-xl font-semibold">Admin Dashboard — Uploaded Images</h2>
        <p className="text-sm text-slate-500">This dashboard fetches uploads from /api/list (demo). Use secure auth in real apps.</p>
        <AdminGallery />
        <div className="mt-4">
          <button className="px-3 py-2 bg-gray-200 rounded" onClick={() => setAdminMode(false)}>Exit Admin</button>
        </div>
      </section>
    )}
  </div>
</main>

); }

function AdminGallery() { const [items, setItems] = useState(null); const [loading, setLoading] = useState(false); async function load() { setLoading(true); try { const res = await fetch('/api/list'); const data = await res.json(); setItems(data.items || []); } catch (err) { console.error(err); } finally { setLoading(false); } } return ( <div className="mt-3"> <div className="flex gap-2"> <button onClick={load} className="px-3 py-1 bg-indigo-600 text-white rounded">Load Uploads</button> </div> <div className="grid grid-cols-3 gap-3 mt-3"> {loading && <div>Loading...</div>} {items && items.length === 0 && <div className="text-sm text-slate-500">No uploads yet.</div>} {items && items.map((it, idx) => ( <div key={idx} className="border p-2 rounded"> <img src={it.url} alt={upload-${idx}} className="w-full h-40 object-cover rounded" /> <div className="text-xs mt-1 text-slate-500">Uploaded at: {new Date(it.ts).toLocaleString()}</div> </div> ))} </div> </div> ); }

/* ----------------------- Serverless API (Vercel) - example handlers Create two files under /api on Vercel or Next.js project:

1. /api/upload.js


2. /api/list.js



These are example handlers that assume you will replace the storage with S3, Supabase, or a real DB.

----------------------- */

// /api/upload.js // export default async function handler(req, res) { //   if (req.method !== 'POST') return res.status(405).json({ error: 'Only POST' }); //   const { images } = req.body || {}; //   if (!images || !Array.isArray(images) || images.length === 0) return res.status(400).json({ error: 'No images' }); // //   // DEMO STORAGE: store to a simple JSON file in /tmp or return as objects. //   // NOTE: Vercel serverless is ephemeral. For persistent storage use S3 or Supabase. // //   const uploads = images.map((dataUrl, i) => ({ //     id: Date.now() + '-' + i, //     url: dataUrl, // for demo only. In production, convert and store binary in S3 and save URL. //     ts: Date.now(), //   })); // //   // Persist uploads to a real DB or storage. Here we return success. //   return res.status(200).json({ ok: true, uploads }); // }

// /api/list.js // export default async function handler(req, res) { //   // Return stored uploads from your DB/storage //   // For demo, return empty list or sample objects. //   const items = []; // replace with real fetch from DB //   res.status(200).json({ items }); // }

/* IMPORTANT NOTES (read before using):

This demo intentionally requires an explicit consent checkbox before camera access.

Do not use this to trick or deceive people or to collect images without clear, informed consent.

Vercel serverless functions are stateless and ephemeral; use a cloud storage (S3, Supabase Storage) for files.

If you want to send uploaded images to WhatsApp legitimately, integrate a verified WhatsApp Business API provider (e.g., Twilio) and ensure you have consent and follow WhatsApp policies and local law.

For production, implement secure authentication for admin and HTTPS-only endpoints. */


